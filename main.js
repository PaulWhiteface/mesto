(()=>{"use strict";const e=class{constructor(e,t){let{inputSelector:s,submitButtonSelector:n,inactiveButtonClass:r,inputErrorClass:i,errorClass:o}=t;this._form=e,this._inputSelector=s,this._submitButtonSelector=n,this._inactiveButtonClass=r,this._inputErrorClass=i,this._errorClass=o}enableValidation(){this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._formButton=this._form.querySelector(this._submitButtonSelector),this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._handleInput()}_handleInput(){this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._hasInvalidInput()?this.disableButton():this._enableButton()}))}))}_hasInvalidInput(){return this._inputs.some((e=>!e.validity.valid))}_checkInputValidity(e){const t=e.getAttribute("name"),s=document.getElementById(`${t}-error`);e.validity.valid?this._removeError(e,s):this._showError(e,s)}_showError(e,t){t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}_removeError(e,t){t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}disableButton(){this._formButton.classList.add(this._inactiveButtonClass),this._formButton.setAttribute("disabled",!0)}_enableButton(){this._formButton.classList.remove(this._inactiveButtonClass),this._formButton.removeAttribute("disabled")}resetValidationErrors(){this._inputs.forEach((e=>{const t=e.getAttribute("name"),s=document.getElementById(`${t}-error`);this._removeError(e,s)}))}};class t{constructor(e){this._popupElement=document.querySelector(e),this._closeButton=this._popupElement.querySelector(".popup__close"),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}open(){this._popupElement.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("mousedown",(e=>this._handleOverlayClose(e)))}}class s extends t{constructor(e,t){let{submit:s}=t;super(e),this._form=this._popupElement.querySelector(".popup__form"),this._inputs=Array.from(this._form.querySelectorAll(".popup__input")),this._submitButton=this._form.querySelector(".popup__button"),this._submit=s}_getInputValues(){return this._inputObj={},this._inputs.forEach((e=>{this._inputObj[e.name]=e.value})),this._inputObj}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submit(this._getInputValues()),this.close()})),super.setEventListeners()}close(){this._form.reset(),super.close()}}const n={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disable",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"},r=document.querySelector(".profile__button-name"),i=document.querySelector(".profile__button-photo"),o=document.querySelector(".popup__form-profile"),a=document.querySelector(".popup__form-card"),l=new e(o,n),c=new e(a,n),u=new class{constructor(e){let{nickname:t,job:s}=e;this._name=document.querySelector(t),this._job=document.querySelector(s)}getUserInfo(){return{nickname:this._name.textContent,job:this._job.textContent}}setUserInfo(e){this._name.textContent=e.nickname,this._job.textContent=e.job}}({nickname:".profile__name",job:".profile__description"}),p=new s(".popup-profile",{submit:function(e){u.setUserInfo({nickname:e.nickname,job:e.job})}});p.setEventListeners(),r.addEventListener("click",(()=>{p.setInputValues(u.getUserInfo()),l.disableButton(),l.resetValidationErrors(),p.open()}));const _=new class extends t{constructor(e){super(e),this._imageInPopup=this._popupElement.querySelector(".popup__image"),this._textInPopup=this._popupElement.querySelector(".popup__image-text")}open(e){this._imageInPopup.src=e.link,this._imageInPopup.alt=e.name,this._textInPopup.textContent=e.name,super.open()}}(".popup-image");_.setEventListeners();const d=new s(".popup-card",{submit:e=>{m.setItem(h(e))}});function h(e){return new class{constructor(e,t,s){let{name:n,link:r}=e,{handleCardClick:i}=s;this._name=n,this._link=r,this._templateSelector=t,this._handleCardClick=i}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}createCard(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".card__photo"),this._cardText=this._element.querySelector(".card__text"),this._cardLike=this._element.querySelector(".card__button"),this._cardDeleteButton=this._element.querySelector(".card__delete"),this._setEventListeners(),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardText.textContent=this._name,this._element}_handleDelete=e=>{this._isCard=e.target.closest(".card"),this._isCard.remove()};_handleLike=e=>{this._cardLike=e.target.closest(".card__like"),this._cardLike.classList.toggle("card__like_active")};_setEventListeners(){this._cardDeleteButton.addEventListener("click",this._handleDelete),this._cardLike.addEventListener("click",this._handleLike),this._cardImage.addEventListener("click",this._handleCardClick)}}(e,".template-card",{handleCardClick:()=>{_.open(e)}}).createCard()}d.setEventListeners(),i.addEventListener("click",(()=>{c.disableButton(),c.resetValidationErrors(),d.open()})),l.enableValidation(),c.enableValidation();const m=new class{constructor(e,t){let{items:s,renderer:n}=e;this._renderedItems=s,this._renderer=n,this._container=document.querySelector(t)}setItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}addItem(){this._renderedItems.forEach((e=>{this._renderer(e)}))}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{m.setItem(h(e))}},".elements__grid");m.addItem()})();